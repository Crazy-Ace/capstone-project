"use strict";function Dialog(t,e){this.dialogEl=t,this.overlayEl=e,this.focusedElBeforeOpen;var n=this.dialogEl.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]');this.focusableEls=Array.prototype.slice.call(n),this.firstFocusableEl=this.focusableEls[0],this.lastFocusableEl=this.focusableEls[this.focusableEls.length-1],this.close()}function IDB(){this._dbPromise=this._setupDB()}function NotificationsService(t){this.serviceWorkerReg=t}function Toast(t,e){this.toastContainerEl=document.querySelector(".toast-container"),this.toastEl=document.querySelector(".toast"),this._open(t,e)}Dialog.prototype.open=function(){var t=this;this.dialogEl.removeAttribute("aria-hidden"),this.overlayEl.removeAttribute("aria-hidden"),this.focusedElBeforeOpen=document.activeElement,this.dialogEl.addEventListener("keydown",function(e){t._handleKeyDown(e)}),this.overlayEl.addEventListener("click",function(){t.close()}),this.firstFocusableEl.focus()},Dialog.prototype.close=function(){this.dialogEl.setAttribute("aria-hidden",!0),this.overlayEl.setAttribute("aria-hidden",!0),this.focusedElBeforeOpen&&this.focusedElBeforeOpen.focus()},Dialog.prototype._handleKeyDown=function(t){function e(){document.activeElement===i.firstFocusableEl&&(t.preventDefault(),i.lastFocusableEl.focus())}function n(){document.activeElement===i.lastFocusableEl&&(t.preventDefault(),i.firstFocusableEl.focus())}var i=this,s=9,r=27;switch(t.keyCode){case s:if(1===i.focusableEls.length){t.preventDefault();break}t.shiftKey?e():n();break;case r:i.close()}},Dialog.prototype.addEventListeners=function(t,e){for(var n=this,i=document.querySelectorAll(t),s=0;s<i.length;s++)i[s].addEventListener("click",function(){n.open()});for(var r=document.querySelectorAll(e),s=0;s<r.length;s++)r[s].addEventListener("click",function(){n.close()})},IDB.prototype._setupDB=function(){return navigator.serviceWorker?idb.open("bitsofcode",1,function(t){var e=t.createObjectStore("Articles",{keyPath:"guid"});e.createIndex("guid","guid");var n=t.createObjectStore("Bookmarks",{keyPath:"guid"});n.createIndex("guid","guid");t.createObjectStore("Settings",{keyPath:"setting"})}):Promise.reject()},IDB.prototype.add=function(t,e){return this._dbPromise.then(function(n){var i=n.transaction(t,"readwrite"),s=i.objectStore(t);return s.put(e),i.complete})},IDB.prototype.search=function(t,e,n,i){var s=[];return this._dbPromise.then(function(n){var i=n.transaction(t,"readwrite"),s=i.objectStore(t);if(!e)return s.openCursor();var r=s.index(e);return r.openCursor()}).then(function t(e){if(e)return e.value[n]==i&&s.push(e.value),e.continue().then(t)}).then(function(){return s})},IDB.prototype.remove=function(t,e,n,i){return this._dbPromise.then(function(n){var i=n.transaction(t,"readwrite"),s=i.objectStore(t);if(!e)return s.openCursor();var r=s.index(e);return r.openCursor()}).then(function t(e){if(e)return e.value[n]==i&&e.delete(),e.continue().then(t)}).then(function(){return!0})},IDB.prototype.retrieve=function(t,e,n){return this._dbPromise.then(function(i){var s=i.transaction(t),r=s.objectStore(t);if(!n)return r.getAll();var o=r.index(e);return o.getAll(n)})},NotificationsService.prototype.subscribe=function(){var t=this;return new Promise(function(e,n){t.serviceWorkerReg.pushManager.subscribe({userVisibleOnly:!0}).then(function(e){return t._sendSubscriptionToDatabase("POST",e)}).then(function(){return e()}).catch(function(){return n()})})},NotificationsService.prototype.unsubscribe=function(){var t=this;return new Promise(function(e,n){t.serviceWorkerReg.pushManager.getSubscription().then(function(i){i.unsubscribe().then(function(){return t._sendSubscriptionToDatabase("DELETE",i)}).then(function(){return e()}).catch(function(){return n()})})})},NotificationsService.prototype._sendSubscriptionToDatabase=function(t,e){var n=e.endpoint.split("gcm/send/")[1],i={method:t,headers:{"Content-Type":"application/json"},body:{uid:n}};return new Promise(function(t,e){fetch("https://timigod-notify.herokuapp.com/uid",i).then(function(t){return t.json()}).then(function(n){n.errors&&e(),t()})})},Toast.prototype._close=function(){this.toastContainerEl.classList.remove("open")},Toast.prototype._open=function(t,e){this.toastEl.classList.remove("success","warning","danger"),this.toastEl.classList.add(t),this.toastContainerEl.classList.add("open"),this.toastEl.innerHTML="\n        <p>"+e+'</p>\n        <button type="button" aria-label="Close Message" class="close-toast btn-bare"> Close </button>\n    ',this._addEventListeners()},Toast.prototype._addEventListeners=function(){var t=this;document.querySelector(".close-toast").addEventListener("click",function(){t._close()})};