"use strict";function Dialog(t,e){this.dialogEl=t,this.overlayEl=e,this.focusedElBeforeOpen;var n=this.dialogEl.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]');this.focusableEls=Array.prototype.slice.call(n),this.firstFocusableEl=this.focusableEls[0],this.lastFocusableEl=this.focusableEls[this.focusableEls.length-1],this.close()}function IDB(){this._dbPromise=this._setupDB()}function NotificationsService(t){this.serviceWorkerReg=t,this.sub,this.uid}function Toast(t,e){this.toastContainerEl=document.querySelector(".toast-container"),this.toastEl=document.querySelector(".toast"),this._open(t,e)}Dialog.prototype.open=function(){var t=this;this.dialogEl.removeAttribute("aria-hidden"),this.overlayEl.removeAttribute("aria-hidden"),this.focusedElBeforeOpen=document.activeElement,this.dialogEl.addEventListener("keydown",function(e){t._handleKeyDown(e)}),this.overlayEl.addEventListener("click",function(){t.close()}),this.firstFocusableEl.focus()},Dialog.prototype.close=function(){this.dialogEl.setAttribute("aria-hidden",!0),this.overlayEl.setAttribute("aria-hidden",!0),this.focusedElBeforeOpen&&this.focusedElBeforeOpen.focus()},Dialog.prototype._handleKeyDown=function(t){function e(){document.activeElement===s.firstFocusableEl&&(t.preventDefault(),s.lastFocusableEl.focus())}function n(){document.activeElement===s.lastFocusableEl&&(t.preventDefault(),s.firstFocusableEl.focus())}var s=this,i=9,r=27;switch(t.keyCode){case i:if(1===s.focusableEls.length){t.preventDefault();break}t.shiftKey?e():n();break;case r:s.close()}},Dialog.prototype.addEventListeners=function(t,e){for(var n=this,s=document.querySelectorAll(t),i=0;i<s.length;i++)s[i].addEventListener("click",function(){n.open()});for(var r=document.querySelectorAll(e),i=0;i<r.length;i++)r[i].addEventListener("click",function(){n.close()})},IDB.prototype._setupDB=function(){return navigator.serviceWorker?idb.open("bitsofcode",1,function(t){var e=t.createObjectStore("Articles",{keyPath:"guid"});e.createIndex("guid","guid"),e.createIndex("pubDate","pubDate");var n=t.createObjectStore("Bookmarks",{keyPath:"guid"});n.createIndex("guid","guid"),n.createIndex("pubDate","pubDate");t.createObjectStore("Settings",{keyPath:"setting"})}):Promise.reject()},IDB.prototype.add=function(t,e){return this._dbPromise.then(function(n){var s=n.transaction(t,"readwrite"),i=s.objectStore(t);return i.put(e),s.complete})},IDB.prototype.search=function(t,e,n,s){var i=[];return this._dbPromise.then(function(n){var s=n.transaction(t,"readwrite"),i=s.objectStore(t);if(!e)return i.openCursor();var r=i.index(e);return r.openCursor()}).then(function t(e){if(e)return e.value[n]==s&&i.push(e.value),e.continue().then(t)}).then(function(){return i})},IDB.prototype.remove=function(t,e,n,s){return this._dbPromise.then(function(n){var s=n.transaction(t,"readwrite"),i=s.objectStore(t);if(!e)return i.openCursor();var r=i.index(e);return r.openCursor()}).then(function t(e){if(e)return e.value[n]==s&&e.delete(),e.continue().then(t)}).then(function(){return!0})},IDB.prototype.retrieve=function(t,e,n){return this._dbPromise.then(function(s){var i=s.transaction(t),r=i.objectStore(t);if(!n)return r.getAll();var o=r.index(e);return o.getAll(n)})},NotificationsService.prototype.subscribe=function(){var t=this;this.isSubscribed||this.serviceWorkerReg.pushManager.subscribe({userVisibleOnly:!0}).then(function(e){t.sub=e,t.isSubscribed=!0,t._sendUIDToAPI()})},NotificationsService.prototype.unsubscribe=function(){var t=this;this.isSubscribed&&this.sub.unsubscribe().then(function(e){t.isSubscribed=!1,console.log("Unsubscribed!",e)}).catch(function(t){console.log("Error unsubscribing",t)})},NotificationsService.prototype._sendUIDToAPI=function(){this.uid=this.sub.endpoint.split("gcm/send/")[1];var t={method:"POST",headers:{"Content-Type":"application/json"},body:{uid:this.uid}};console.log(t),fetch("https://timigod-notify.herokuapp.com/uid",t).then(function(t){return t.json()}).then(function(t){console.log(t),t.errors||console.log("Succesfully added uid")})},Toast.prototype._close=function(){this.toastContainerEl.classList.remove("open")},Toast.prototype._open=function(t,e){this.toastEl.classList.remove("success","warning","danger"),this.toastEl.classList.add(t),this.toastContainerEl.classList.add("open"),this.toastEl.innerHTML="\n        <p>"+e+'</p>\n        <button type="button" aria-label="Close Message" class="close-toast btn-bare"> Close </button>\n    ',this._addEventListeners()},Toast.prototype._addEventListeners=function(){var t=this;document.querySelector(".close-toast").addEventListener("click",function(){t._close()})};